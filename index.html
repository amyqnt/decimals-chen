<script>
document.addEventListener('DOMContentLoaded', () => {
  function generateDecimalQuestion() {
    const num1 = (Math.random() * 0.99).toFixed(2);
    const num2 = (Math.random() * 0.99).toFixed(2);
    const correctAnswer = (parseFloat(num1) + parseFloat(num2)).toFixed(2);
    const question = `What is ${num1} + ${num2}?`;

    const options = new Set([correctAnswer]);
    while (options.size < 4) {
      const wrong = (parseFloat(correctAnswer) + (Math.random() * 0.2 - 0.1)).toFixed(2);
      if (wrong >= 0 && wrong <= 1.98) options.add(wrong);
    }
    return { question, correct: correctAnswer, options: Array.from(options).sort(() => Math.random() - 0.5) };
  }

  const questions = Array.from({ length: 10 }, generateDecimalQuestion);

  let streak = 0, correctCount = 0, totalCount = 0, quizLocked = false, currentIndex = 0;

  function updateScoreboard() {
    document.getElementById('streak-el').textContent = streak;
    const pct = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;
    document.getElementById('percentage-el').textContent = `${pct}%`;
    const prog = Math.min(100, (correctCount / 10) * 100);
    document.getElementById('progress-pointer').style.left = `${prog}%`;
  }

  function newQuestion() {
    if (correctCount >= 10) {
      document.getElementById('quiz-section').style.display = 'none';
      document.getElementById('end-screen').style.display = 'flex';
      return;
    }

    quizLocked = false;
    document.getElementById('feedback').textContent = '';
    document.getElementById('next-btn').disabled = true;
    document.getElementById('next-btn').classList.add('opacity-50', 'cursor-not-allowed');

    const q = questions[currentIndex];
    document.getElementById('question').textContent = q.question;
    const container = document.getElementById('choices-container');
    container.innerHTML = '';
    q.options.forEach(opt => {
      const btn = document.createElement('button');
      btn.className = 'p-3 bg-blue-500 text-white font-bold rounded-lg shadow-md hover:bg-blue-600 transition-colors';
      btn.textContent = opt;
      btn.onclick = () => checkAnswer(opt, q.correct, btn);
      container.appendChild(btn);
    });
  }

  function checkAnswer(selected, correct, btn) {
    if (quizLocked) return;
    quizLocked = true;
    totalCount++;

    const fb = document.getElementById('feedback');
    const allBtns = document.querySelectorAll('#choices-container button');
    allBtns.forEach(b => {
      b.disabled = true;
      b.classList.remove('bg-blue-500');
      if (b.textContent === correct) {
        b.classList.add('bg-green-500');
      } else {
        b.classList.add('bg-blue-200');
      }
    });

    if (selected === correct) {
      fb.textContent = 'Correct!';
      fb.style.color = '#16a34a';
      correctCount++;
      streak++;
      currentIndex++; 
    } else {
      fb.textContent = `The correct answer is ${correct}.`;
      fb.style.color = '#dc2626';
      streak = 0;
      
    }

    updateScoreboard();
    document.getElementById('next-btn').disabled = false;
    document.getElementById('next-btn').classList.remove('opacity-50', 'cursor-not-allowed');
  }

  document.getElementById('next-btn').addEventListener('click', newQuestion);
  document.getElementById('restart-btn').addEventListener('click', () => {
    streak = 0; 
    correctCount = 0; 
    totalCount = 0; 
    currentIndex = 0;
    updateScoreboard();
    document.getElementById('end-screen').style.display = 'none';
    document.getElementById('quiz-section').style.display = 'block';
    newQuestion();
  });

  newQuestion();
  updateScoreboard();
});
</script>
